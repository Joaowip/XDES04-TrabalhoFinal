<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barbearia - Usuário</title>
  <link rel="stylesheet" href="../style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Ícone da página -->
  <link rel="icon" href="../imagens/icon.png" type="image/png">
</head>

<body>
  <!-- Barra de Navegação (Header) -->
  <header class="navbar navbar-expand-lg navbar-dark bg-dark p-3">
    <div class="container d-flex justify-content-between align-items-center w-100">
      <!-- Botão de Voltar Alinhado à Esquerda e mais para cima -->
      <a href="javascript:history.back()" class="navbar-brand d-flex align-items-center me-auto" style="margin-top: -10px;">
        <img src="../imagens/voltar.png" alt="Voltar" height="30"> <!-- Imagem de Voltar -->
      </a>

      <!-- Logotipo -->
      <a href="#" class="navbar-brand d-flex align-items-center">
        <img src="../imagens/logo.png" alt="Logotipo" height="80"> <!-- Logotipo da Barbearia -->
      </a>

      <!-- Título Centralizado -->
      <h1 class="text-center mb-4 flex-grow-1">Sistema de Gestão da Barbearia</h1>

      <!-- Ícone do Usuário, Alinhado à Direita -->
      <div class="d-flex align-items-center">
        <a href="#" class="nav-link text-white">
          <img src="../imagens/icon.png" alt="Ícone da Barbearia" height="80"> <!-- Ícone da Barbearia -->
        </a>
      </div>
    </div>
  </header>

  <div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Lista de usuários</h2>
      <div class="d-flex">
        <button id="btnConsulta" class="btn btn-info me-2" data-bs-toggle="modal"
          data-bs-target="#modalConsulta">Consultar Usuário</button>
        <button id="btnNovoUsuario" class="btn btn-primary" data-bs-toggle="modal"
          data-bs-target="#modalCadastro">Cadastrar Novo Usuário</button>
      </div>
    </div>

    <!-- Filtro de Consulta -->
    <div class="modal fade" id="modalConsulta" tabindex="-1" aria-labelledby="modalConsultaLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalConsultaLabel">Consulta de Usuários</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="consultaForm">
              <div class="mb-3">
                <label for="consultaNome" class="form-label">Nome</label>
                <input type="text" class="form-control" id="consultaNome" placeholder="Digite o nome do usuário">
              </div>
              <div class="mb-3">
                <label for="consultaDataNascimento" class="form-label">Data de Nascimento</label>
                <input type="date" class="form-control" id="consultaDataNascimento">
              </div>
              <div class="mb-3">
                <label for="consultaMatricula" class="form-label">Matrícula</label>
                <input type="number" class="form-control" id="consultaMatricula" placeholder="Digite a matrícula">
              </div>
              <div class="mb-3">
                <label for="consultaTipo" class="form-label">Tipo</label>
                <select class="form-select" id="consultaTipo">
                  <option value="todos">Todos</option>
                  <option value="Administrador">Administrador</option>
                  <option value="Barbeiro">Barbeiro</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="consultaStatus" class="form-label">Status</label>
                <select class="form-select" id="consultaStatus">
                  <option value="todos">Todos</option>
                  <option value="Ativo">Ativo</option>
                  <option value="Inativo">Inativo</option>
                </select>
              </div>
              <button type="submit" class="btn btn-info w-100">Consultar</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th>Matrícula</th>
          <th>Nome</th>
          <th>CPF</th>
          <th>Data de Nascimento</th>
          <th>Endereço</th>
          <th>Gênero</th>
          <th>Telefone</th>
          <th>Email</th>
          <th>Senha de Acesso</th>
          <th>Tipo</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="userTableBody"></tbody>
    </table>
  </div>

  <!-- Modal Cadastro de Usuário -->
  <div class="modal fade" id="modalCadastro" tabindex="-1" aria-labelledby="modalCadastroLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCadastroLabel">Cadastro de Usuário</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="userForm">
            <div class="mb-3">
              <label for="nome" class="form-label">Nome Completo*</label>
              <input type="text" class="form-control" id="nome" required>
            </div>
            <div class="mb-3">
              <label for="cpf" class="form-label">CPF*</label>
              <input type="text" class="form-control" id="cpf" required>
            </div>
            <div class="mb-3">
              <label for="dataNascimento" class="form-label">Data de Nascimento*</label>
              <input type="date" class="form-control" id="dataNascimento" required>
            </div>
            <div class="mb-3">
              <label for="endereco" class="form-label">Endereço*</label>
              <input type="text" class="form-control" id="endereco" required>
            </div>
            <div class="mb-3">
              <label for="genero" class="form-label">Gênero</label>
              <select class="form-select" id="genero" required>
                <option value="Masculino">Masculino</option>
                <option value="Feminino">Feminino</option>
                <option value="Não-binário">Não-binário</option>
                <option value="Outros">Outros</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="telefone" class="form-label">Telefone*</label>
              <input type="text" class="form-control" id="telefone" required>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email">
            </div>
            <div class="mb-3">
              <label for="matricula" class="form-label">Matrícula*</label>
              <input type="text" class="form-control" id="matricula" readonly>
            </div>
            <div class="mb-3">
              <label for="senha" class="form-label">Senha de Acesso*</label>
              <input type="password" class="form-control" id="senha" required>
            </div>
            <div class="mb-3">
              <label for="tipo" class="form-label">Tipo</label>
              <select class="form-select" id="tipo" required>
                <option value="Barbeiro" selected>Barbeiro</option>
                <option value="Administrador">Administrador</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="status" class="form-label">Status</label>
              <select class="form-select" id="status" required>
                <option value="Ativo" selected>Ativo</option>
                <option value="Inativo">Inativo</option>
              </select>
            </div>
            <button type="submit" class="btn btn-success w-100">Cadastrar Usuário</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Edição de Usuário -->
  <div class="modal fade" id="modalEdicao" tabindex="-1" aria-labelledby="modalEdicaoLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalEdicaoLabel">Editar Usuário</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="userEditForm">
            <input type="hidden" id="editIndex">
            <div class="mb-3">
              <label for="editNome" class="form-label">Nome Completo*</label>
              <input type="text" class="form-control" id="editNome" required>
            </div>
            <div class="mb-3">
              <label for="editEndereco" class="form-label">Endereço*</label>
              <input type="text" class="form-control" id="editEndereco" required>
            </div>
            <div class="mb-3">
              <label for="editTelefone" class="form-label">Telefone*</label>
              <input type="text" class="form-control" id="editTelefone" required>
            </div>
            <div class="mb-3">
              <label for="editEmail" class="form-label">E-mail</label>
              <input type="email" class="form-control" id="editEmail">
            </div>
            <div class="mb-3">
              <label for="editSenha" class="form-label">Senha de Acesso*</label>
              <input type="password" class="form-control" id="editSenha" required>
            </div>
            <div class="mb-3">
              <label for="editTipo" class="form-label">Tipo</label>
              <select class="form-select" id="editTipo" required>
                <option value="Barbeiro">Barbeiro</option>
                <option value="Administrador">Administrador</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="editStatus" class="form-label">Status</label>
              <select class="form-select" id="editStatus" required>
                <option value="Ativo">Ativo</option>
                <option value="Inativo">Inativo</option>
              </select>
            </div>
            <button type="submit" class="btn btn-warning w-100">Atualizar Usuário</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </script>
  <script>
    // Função para gerar número aleatório de 4 dígitos
    const generateMatricula = () => {
      return Math.floor(1000 + Math.random() * 9000); // Gera um número aleatório entre 1000 e 9999
    };

    // Função para formatar data no formato dd/mm/yyyy
    const formatarDataNascimento = (data) => {
      const [ano, mes, dia] = data.split("-");
      return `${dia}/${mes}/${ano}`;
    };

    let users = [
      {
        matricula: 3756,
        nome: "João Silva",
        cpf: "123.456.789-00",
        dataNascimento: "1990-05-14",
        endereco: "Rua A, 123",
        genero: "Masculino",
        telefone: "(11) 91234-5678",
        email: "joao.silva@email.com",
        senha: "senha123",
        tipo: "Administrador",
        status: "Ativo"
      },
      {
        matricula: 1254,
        nome: "Maria Oliveira",
        cpf: "987.654.321-00",
        dataNascimento: "1985-08-22",
        endereco: "Avenida B, 456",
        genero: "Feminino",
        telefone: "(11) 99876-5432",
        email: "maria.oliveira@email.com",
        senha: "senha456",
        tipo: "Barbeiro",
        status: "Ativo"
      },
      {
        matricula: 2205,
        nome: "Carlos Pereira",
        cpf: "456.789.123-00",
        dataNascimento: "1992-11-30",
        endereco: "Rua C, 789",
        genero: "Masculino",
        telefone: "(11) 92345-6789",
        email: "carlos.pereira@email.com",
        senha: "senha789",
        tipo: "Administrador",
        status: "Inativo"
      }
    ];

    const loadTableData = () => {
      const userTableBody = document.getElementById("userTableBody");
      userTableBody.innerHTML = "";
      users.forEach(user => {
        const row = document.createElement("tr");
        row.innerHTML = `
      <td>${user.matricula}</td>
      <td>${user.nome}</td>
      <td>${user.cpf}</td>
      <td>${formatarDataNascimento(user.dataNascimento)}</td>
      <td>${user.endereco}</td>
      <td>${user.genero}</td>
      <td>${user.telefone}</td>
      <td>${user.email}</td>
      <td>${user.senha}</td>
      <td>${user.tipo}</td>
      <td>${user.status}</td>
      <td>
        <button class="btn btn-warning" onclick="editUser(${user.matricula})">Editar</button>
        <button class="btn btn-danger" onclick="deleteUser(${user.matricula})">Excluir</button>
      </td>
    `;
        userTableBody.appendChild(row);
      });
    };

    document.getElementById("userForm").onsubmit = (event) => {
      event.preventDefault();

      const newUser = {
        matricula: generateMatricula(),
        nome: document.getElementById("nome").value,
        cpf: document.getElementById("cpf").value,
        dataNascimento: document.getElementById("dataNascimento").value,
        endereco: document.getElementById("endereco").value,
        genero: document.getElementById("genero").value,
        telefone: document.getElementById("telefone").value,
        email: document.getElementById("email").value,
        senha: document.getElementById("senha").value,
        tipo: document.getElementById("tipo").value,
        status: document.getElementById("status").value
      };

      users.push(newUser);
      loadTableData();

      const modalCadastro = bootstrap.Modal.getInstance(document.getElementById("modalCadastro"));
      modalCadastro.hide();

      document.getElementById("userForm").reset();
    };

    window.onload = loadTableData;

    // Função para abrir o modal e preencher os campos
    const editUser = (matricula) => {
      const user = users.find(u => u.matricula === matricula);
      if (user) {
        // Preencher os campos do modal com os dados do usuário
        document.getElementById("editIndex").value = matricula;
        document.getElementById("editNome").value = user.nome;
        document.getElementById("editEndereco").value = user.endereco;
        document.getElementById("editTelefone").value = user.telefone;
        document.getElementById("editEmail").value = user.email;
        document.getElementById("editSenha").value = user.senha;
        document.getElementById("editTipo").value = user.tipo;
        document.getElementById("editStatus").value = user.status;

        const modalEdicao = new bootstrap.Modal(document.getElementById("modalEdicao"));
        modalEdicao.show();
      }
    };

    // Função para atualizar um usuário
    document.getElementById("userEditForm").onsubmit = (event) => {
      event.preventDefault();

      const matricula = document.getElementById("editIndex").value;
      const user = users.find(u => u.matricula == matricula);

      if (user) {
        user.nome = document.getElementById("editNome").value;
        user.endereco = document.getElementById("editEndereco").value;
        user.telefone = document.getElementById("editTelefone").value;
        user.email = document.getElementById("editEmail").value;
        user.senha = document.getElementById("editSenha").value;
        user.tipo = document.getElementById("editTipo").value;
        user.status = document.getElementById("editStatus").value;

        loadTableData();  // Recarregar a tabela com os dados atualizados

        const modalEdicao = bootstrap.Modal.getInstance(document.getElementById("modalEdicao"));
        modalEdicao.hide();  // Fechar o modal após salvar as alterações
      }
    };

    const deleteUser = (matricula) => {
      const confirmDelete = confirm("Você tem certeza que deseja excluir este usuário?");
      if (confirmDelete) {
        users = users.filter(u => u.matricula !== matricula);
        loadTableData();
      }
    };

    // Função de consulta implementada
    const consultaForm = document.getElementById("consultaForm");

    consultaForm.addEventListener("submit", (event) => {
      event.preventDefault();

      const nome = document.getElementById("consultaNome").value.toLowerCase();
      const dataNascimento = document.getElementById("consultaDataNascimento").value;
      const matricula = document.getElementById("consultaMatricula").value;
      const tipo = document.getElementById("consultaTipo").value;
      const status = document.getElementById("consultaStatus").value;

      // Fechar o modal após a consulta (esse é o que você precisa adicionar)
      const modalConsulta = bootstrap.Modal.getInstance(document.getElementById("modalConsulta"));
      modalConsulta.hide();

      const filteredUsers = users.filter(user => {
        const matchesNome = nome ? user.nome.toLowerCase().includes(nome) : true;
        const matchesDataNascimento = dataNascimento ? user.dataNascimento === dataNascimento : true;
        const matchesMatricula = matricula ? user.matricula.toString() === matricula : true;
        const matchesTipo = tipo ? (tipo === "todos" || user.tipo === tipo) : true;
        const matchesStatus = status ? (status === "todos" || user.status === status) : true;

        return matchesNome && matchesDataNascimento && matchesMatricula && matchesTipo && matchesStatus;
      });

      const userTableBody = document.getElementById("userTableBody");
      userTableBody.innerHTML = "";

      filteredUsers.forEach(user => {
        const row = document.createElement("tr");
        row.innerHTML = `
        <td>${user.matricula}</td>
        <td>${user.nome}</td>
        <td>${user.cpf}</td>
        <td>${user.dataNascimento}</td>
        <td>${user.endereco}</td>
        <td>${user.genero}</td>
        <td>${user.telefone}</td>
        <td>${user.email}</td>
        <td>${user.senha}</td>
        <td>${user.tipo}</td>
        <td>${user.status}</td>
        <td>
          <button class="btn btn-warning" onclick="editUser(${user.matricula})">Editar</button>
          <button class="btn btn-danger" onclick="deleteUser(${user.matricula})">Excluir</button>
        </td>
      `;
        userTableBody.appendChild(row);
      });
    });
  </script>

</body>

</html>