<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barbearia - Cliente</title>
  <link rel="stylesheet" href="../style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Ícone da página -->
  <link rel="icon" href="../imagens/icon.png" type="image/png">
</head>
<body>

  <!-- Barra de Navegação (Header) -->
  <header class="navbar navbar-expand-lg navbar-dark bg-dark p-3">
    <div class="container d-flex justify-content-between align-items-center w-100">
      <!-- Logotipo -->
      <a href="#" class="navbar-brand d-flex align-items-center">
        <img src="../imagens/logo.png" alt="Logotipo" height="80"> <!-- Logotipo da Barbearia -->
      </a>

      <!-- Título Centralizado -->
      <h1 class="text-center mb-4 flex-grow-1">Sistema de Gestão da Barbearia</h1>

      <!-- Ícone do Usuário, Alinhado à Direita -->
      <div class="d-flex align-items-center">
        <a href="#" class="nav-link text-white">
          <img src="../imagens/icon.png" alt="Ícone da Barbearia" height="80"> <!-- Ícone da Barbearia -->
        </a>
      </div>
    </div>
  </header>
  
  <div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Lista de Clientes</h2>
      <div>
        <button id="btnConsultarClientes" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#modalConsultarCliente">Consultar Clientes</button>
        <button id="btnNovoCliente" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCadastroCliente">Cadastrar Novo Cliente</button>
      </div>
    </div>    

    <table class="table table-striped">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CPF</th>
          <th>Data de Nascimento</th>
          <th>Telefone</th>
          <th>Fidelidade</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="clientTableBody"></tbody>
    </table>
  </div>

  <!-- Modal de Cadastro de Cliente -->
  <div class="modal fade" id="modalCadastroCliente" tabindex="-1" aria-labelledby="modalCadastroClienteLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCadastroClienteLabel">Cadastro de Cliente</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="clientForm">
            <div class="mb-3">
              <label for="nome" class="form-label">Nome Completo*</label>
              <input type="text" class="form-control" id="nome" required>
            </div>
            <div class="mb-3">
              <label for="cpf" class="form-label">CPF*</label>
              <input type="text" class="form-control" id="cpf" required>
            </div>
            <div class="mb-3">
              <label for="dataNascimento" class="form-label">Data de Nascimento*</label>
              <input type="date" class="form-control" id="dataNascimento" required>
            </div>
            <div class="mb-3">
              <label for="telefone" class="form-label">Telefone*</label>
              <input type="text" class="form-control" id="telefone" required>
            </div>
            <div class="mb-3">
              <label for="fidelidade" class="form-label">Fidelidade</label>
              <select class="form-select" id="fidelidade">
                <option value="Não" selected>Não</option>
                <option value="Sim">Sim</option>
              </select>
            </div>
            <button type="submit" class="btn btn-success w-100">Cadastrar Cliente</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Consulta de Clientes -->
  <div class="modal fade" id="modalConsultarCliente" tabindex="-1" aria-labelledby="modalConsultarClienteLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalConsultarClienteLabel">Consultar Clientes</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="filterForm">
            <div class="mb-3">
              <label for="filterNome" class="form-label">Nome</label>
              <input type="text" class="form-control" id="filterNome">
            </div>
            <div class="mb-3">
              <label for="filterDataNascimento" class="form-label">Data de Nascimento</label>
              <input type="date" class="form-control" id="filterDataNascimento">
            </div>
            <div class="mb-3">
              <label for="filterCpf" class="form-label">CPF</label>
              <input type="text" class="form-control" id="filterCpf">
            </div>
            <div class="mb-3">
              <label for="filterFidelidade" class="form-label">Fidelidade</label>
              <select class="form-select" id="filterFidelidade">
                <option value="">Todos</option>
                <option value="Sim">Sim</option>
                <option value="Não">Não</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary w-100">Filtrar</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Edição de Cliente -->
  <div class="modal fade" id="modalEditarCliente" tabindex="-1" aria-labelledby="modalEditarClienteLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalEditarClienteLabel">Editar Cliente</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editClientForm">
            <div class="mb-3">
              <label for="editNome" class="form-label">Nome Completo*</label>
              <input type="text" class="form-control" id="editNome" required>
            </div>
            <div class="mb-3">
              <label for="editTelefone" class="form-label">Telefone*</label>
              <input type="text" class="form-control" id="editTelefone" required>
            </div>
            <div class="mb-3">
              <label for="editFidelidade" class="form-label">Fidelidade</label>
              <select class="form-select" id="editFidelidade">
                <option value="Não">Não</option>
                <option value="Sim">Sim</option>
              </select>
            </div>
            <button type="submit" class="btn btn-success w-100">Salvar Alterações</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let clientes = [
      { nome: "João Silva", cpf: "123.456.789-00", dataNascimento: "1990-05-12", telefone: "(11) 98765-4321", fidelidade: "Sim" },
      { nome: "Maria Oliveira", cpf: "234.567.890-11", dataNascimento: "1985-09-22", telefone: "(21) 91234-5678", fidelidade: "Não" },
      { nome: "Carlos Souza", cpf: "345.678.901-22", dataNascimento: "1992-03-15", telefone: "(31) 92345-6789", fidelidade: "Sim" }
    ];

    // Função para formatar a data no formato dd mm yyyy
function formatData(data) {
  const [ano, mes, dia] = data.split('-');
  return `${dia}/${mes}/${ano}`;
}

    // Função para formatar CPF
    function formatCPF(cpf) {
      return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
    }

    // Função para formatar Telefone
    function formatTelefone(telefone) {
      return telefone.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
    }

    // Função para renderizar a tabela de clientes
function renderClientTable(clientList = clientes) {
  const clientTableBody = document.getElementById("clientTableBody");
  clientTableBody.innerHTML = "";

  clientList.forEach((client, index) => {
    const row = clientTableBody.insertRow();

    row.innerHTML = `
      <td>${client.nome}</td>
      <td>${formatCPF(client.cpf)}</td>
      <td>${formatData(client.dataNascimento)}</td> <!-- Alteração aqui -->
      <td>${formatTelefone(client.telefone)}</td>
      <td>${client.fidelidade}</td>
      <td>
        <button onclick="editarCliente(${index})" class="btn btn-warning btn-sm">Editar</button>
        <button onclick="excluirCliente(${index})" class="btn btn-danger btn-sm">Excluir</button>
      </td>
    `;
  });
}



    // Função para adicionar um novo cliente
    function adicionarCliente(cliente) {
      clientes.push(cliente);
      renderClientTable();
    }

    // Função para editar um cliente
    function editarCliente(index) {
      const client = clientes[index];

      document.getElementById("editNome").value = client.nome;
      document.getElementById("editTelefone").value = client.telefone;
      document.getElementById("editFidelidade").value = client.fidelidade;

      const editForm = document.getElementById("editClientForm");
      editForm.onsubmit = function(event) {
        event.preventDefault();

        client.nome = document.getElementById("editNome").value;
        client.telefone = document.getElementById("editTelefone").value;
        client.fidelidade = document.getElementById("editFidelidade").value;

        renderClientTable();

        // Fechar o modal de edição - ajustando a criação da instância
        const modalEditarElement = document.getElementById("modalEditarCliente");
        const modalEditar = bootstrap.Modal.getInstance(modalEditarElement);
        modalEditar.hide();  // Fechar o modal após salvar as alterações
      };

      const modal = new bootstrap.Modal(document.getElementById("modalEditarCliente"));
      modal.show();
    }


    // Função para excluir um cliente
    function excluirCliente(index) {
      clientes.splice(index, 1);
      renderClientTable();
    }

    // Função para filtrar os clientes
function filtrarClientes() {
  const nome = document.getElementById("filterNome").value.toLowerCase();
  const dataNascimento = document.getElementById("filterDataNascimento").value;
  const cpf = document.getElementById("filterCpf").value;
  const fidelidade = document.getElementById("filterFidelidade").value;

  const filteredClients = clientes.filter(client => {
    return (
      (nome ? client.nome.toLowerCase().includes(nome) : true) &&
      (dataNascimento ? formatData(client.dataNascimento) === dataNascimento : true) && // Alteração aqui
      (cpf ? client.cpf.includes(cpf) : true) &&
      (fidelidade ? client.fidelidade === fidelidade : true)
    );
  });

  renderClientTable(filteredClients);
}


    // Função para enviar o formulário de cadastro de cliente
    document.getElementById("clientForm").onsubmit = function(event) {
      event.preventDefault();

      const novoCliente = {
        nome: document.getElementById("nome").value,
        cpf: document.getElementById("cpf").value,
        dataNascimento: document.getElementById("dataNascimento").value,
        telefone: document.getElementById("telefone").value,
        fidelidade: document.getElementById("fidelidade").value
      };

      adicionarCliente(novoCliente);

      // Fechar o modal de cadastro - ajustar a criação da instância
      const modalCadastroElement = document.getElementById("modalCadastroCliente");
      const modalCadastro = bootstrap.Modal.getInstance(modalCadastroElement);
      modalCadastro.hide();  // Fechar o modal após o cadastro
    };

    // Função para enviar o filtro de consulta de clientes
    document.getElementById("filterForm").onsubmit = function(event) {
      event.preventDefault();
      filtrarClientes();

      // Fechar o modal de consulta - ajustando a criação da instância
      const modalConsultaElement = document.getElementById("modalConsultarCliente");
      const modalConsulta = bootstrap.Modal.getInstance(modalConsultaElement);
      modalConsulta.hide();  // Fechar o modal após aplicar o filtro
};

    // Inicializar a tabela com os dados
    renderClientTable();
  </script>
</body>
</html>
