<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barbearia - Atendimentos</title>
  <link rel="stylesheet" href="../style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Ícone da página -->
  <link rel="icon" href="../imagens/icon.png" type="image/png">
</head>

<body>
  <!-- Barra de Navegação (Header) -->
  <header class="navbar navbar-expand-lg navbar-dark bg-dark p-3">
    <div class="container d-flex justify-content-between align-items-center w-100">
      <!-- Botão de Voltar Alinhado à Esquerda e mais para cima -->
      <a href="javascript:history.back()" class="navbar-brand d-flex align-items-center me-auto"
        style="margin-top: -10px;">
        <img src="../imagens/voltar.png" alt="Voltar" height="30"> <!-- Imagem de Voltar -->
      </a>

      <!-- Logotipo -->
      <a href="#" class="navbar-brand d-flex align-items-center">
        <img src="../imagens/logo.png" alt="Logotipo" height="80"> <!-- Logotipo da Barbearia -->
      </a>

      <!-- Título Centralizado -->
      <h1 class="text-center mb-4 flex-grow-1">Sistema de Gestão da Barbearia</h1>

      <!-- Ícone do Usuário, Alinhado à Direita -->
      <div class="d-flex align-items-center">
        <a href="#" class="nav-link text-white">
          <img src="../imagens/icon.png" alt="Ícone da Barbearia" height="80"> <!-- Ícone da Barbearia -->
        </a>
      </div>
    </div>
  </header>

  <div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Lista de Atendimentos</h2>
      <div>
        <button id="btnConsultarAtendimentos" class="btn btn-info" data-bs-toggle="modal"
          data-bs-target="#modalConsultarAtendimento">Consultar Atendimentos</button>
        <button id="btnNovoAtendimento" class="btn btn-primary" data-bs-toggle="modal"
          data-bs-target="#modalCadastroAtendimento">Cadastrar Novo Atendimento</button>
      </div>
    </div>

    <table class="table table-striped">
      <thead>
        <tr>
          <th>Cliente</th>
          <th>Data</th>
          <th>Hora</th>
          <th>Serviço</th>
          <th>Valor do Serviço</th>
          <th>Barbeiro Responsável</th>
          <th>Forma de Pagamento</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="atendimentoTableBody"></tbody>
    </table>
  </div>

  <!-- Modal de Cadastro de Atendimento -->
  <div class="modal fade" id="modalCadastroAtendimento" tabindex="-1" aria-labelledby="modalCadastroAtendimentoLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCadastroAtendimentoLabel">Cadastro de Atendimento</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="clientForm">
            <div class="mb-3">
              <label for="nome" class="form-label">Cliente*</label>
              <input type="text" class="form-control" id="nome" required>
            </div>
            <div class="mb-3">
              <label for="data" class="form-label">Data*</label>
              <input type="date" class="form-control" id="data" required>
            </div>
            <div class="mb-3">
              <label for="hora" class="form-label">Hora*</label>
              <input type="time" class="form-control" id="hora" required>
            </div>
            <div class="mb-3">
              <label for="servico" class="form-label">Serviço*</label>
              <div>
                <input type="checkbox" class="form-check-input" id="servicoCabelo" value="Cabelo">
                <label class="form-check-label" for="servicoCabelo">Cabelo</label>
              </div>
              <div>
                <input type="checkbox" class="form-check-input" id="servicoBarba" value="Barba">
                <label class="form-check-label" for="servicoBarba">Barba</label>
              </div>
              <div>
                <input type="checkbox" class="form-check-input" id="servicoBigode" value="Bigode">
                <label class="form-check-label" for="servicoBigode">Bigode</label>
              </div>
              <div>
                <input type="checkbox" class="form-check-input" id="servicoSobrancelha" value="Sobrancelha">
                <label class="form-check-label" for="servicoSobrancelha">Sobrancelha</label>
              </div>
            </div>
            <div class="mb-3">
              <label for="valorCobrado" class="form-label">Valor Cobrado*</label>
              <input type="text" class="form-control" id="valorCobrado" required>
            </div>
            <div class="mb-3">
              <label for="barbeiroResponsavel" class="form-label">Barbeiro Responsável*</label>
              <input type="text" class="form-control" id="barbeiroResponsavel" required>
            </div>
            <div class="mb-3">
              <label for="formaPagamento" class="form-label">Forma de Pagamento*</label>
              <select class="form-select" id="formaPagamento" required>
                <option value="PIX">PIX</option>
                <option value="Dinheiro em espécie">Dinheiro em espécie</option>
                <option value="Crédito">Crédito</option>
                <option value="Débito">Débito</option>
              </select>
            </div>
            <button type="submit" class="btn btn-success w-100">Cadastrar Atendimento</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Consulta de Atendimentos -->
  <div class="modal fade" id="modalConsultarAtendimento" tabindex="-1" aria-labelledby="modalConsultarAtendimentoLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalConsultarAtendimentoLabel">Consultar Atendimentos</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="filterForm">
            <div class="mb-3">
              <label for="filterCliente" class="form-label">Cliente</label>
              <input type="text" class="form-control" id="filterCliente">
            </div>
            <div class="mb-3">
              <label for="filterData" class="form-label">Data</label>
              <input type="date" class="form-control" id="filterData">
            </div>
            <div class="mb-3">
              <label for="filterHora" class="form-label">Hora</label>
              <input type="time" class="form-control" id="filterHora">
            </div>
            <div class="mb-3">
              <label class="form-label">Serviço</label>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="filterServicoCabelo">
                <label class="form-check-label" for="filterServicoCabelo">Cabelo</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="filterServicoBarba">
                <label class="form-check-label" for="filterServicoBarba">Barba</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="filterServicoBigode">
                <label class="form-check-label" for="filterServicoBigode">Bigode</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="filterServicoSobrancelha">
                <label class="form-check-label" for="filterServicoSobrancelha">Sobrancelha</label>
              </div>
            </div>
            <div class="mb-3">
              <label for="filterBarbeiro" class="form-label">Barbeiro Responsável</label>
              <input type="text" class="form-control" id="filterBarbeiro">
            </div>
            <div class="mb-3">
              <label for="filterFormaPagamento" class="form-label">Forma de Pagamento</label>
              <select class="form-control" id="filterFormaPagamento">
                <option value="todos">Todos</option>
                <option value="pix">PIX</option>
                <option value="dinheiro em espécie">Dinheiro em espécie</option>
                <option value="debito">Débito</option>
                <option value="credito">Crédito</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary w-100">Filtrar</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Edição de Atendimento -->
  <div class="modal fade" id="modalEditarAtendimento" tabindex="-1" aria-labelledby="modalEditarAtendimentoLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalEditarAtendimentoLabel">Editar Atendimento</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editAtendimentoForm">
            <div class="form-group">
              <label for="editCliente">Cliente</label>
              <input type="text" id="editCliente" class="form-control" required>
            </div>

            <div class="form-group">
              <label for="editData">Data</label>
              <input type="date" id="editData" class="form-control" required>
            </div>

            <div class="form-group">
              <label for="editHora">Hora</label>
              <input type="time" id="editHora" class="form-control" required>
            </div>

            <div class="form-group">
              <label>Serviços</label><br>
              <input type="checkbox" id="editServicoCabelo"> Cabelo
              <input type="checkbox" id="editServicoBarba"> Barba
              <input type="checkbox" id="editServicoBigode"> Bigode
              <input type="checkbox" id="editServicoSobrancelha"> Sobrancelha
            </div>

            <div class="form-group">
              <label for="editBarbeiroResponsavel">Barbeiro Responsável</label>
              <input type="text" id="editBarbeiroResponsavel" class="form-control" required>
            </div>

            <div class="form-group">
              <label for="editFormaPagamento">Forma de Pagamento</label>
              <input type="text" id="editFormaPagamento" class="form-control">
            </div>

            <div class="form-group">
              <label for="editValorCobrado">Valor Cobrado</label>
              <input type="number" id="editValorCobrado" class="form-control" required>
            </div>

            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let atendimentos = [
      { cliente: "João Silva", data: "2024-11-15", hora: "10:00", servico: "Cabelo, Barba, Bigode", valorCobrado: "40.00", barbeiroResponsavel: "Carlos", formaPagamento: "PIX" },
      { cliente: "Maria Oliveira", data: "2024-11-16", hora: "14:00", servico: "Sobrancelha", valorCobrado: "15.00", barbeiroResponsavel: "Ricardo", formaPagamento: "Dinheiro em espécie" },
      { cliente: "Carlos Souza", data: "2024-11-17", hora: "16:00", servico: "Barba, Bigode", valorCobrado: "30.00", barbeiroResponsavel: "Eduardo", formaPagamento: "PIX" }
    ];

    // Função para formatar a data
    function formatData(data) {
      const [year, month, day] = data.split("-");
      return `${day}/${month}/${year}`;
    }

    // Função para formatar a hora
    function formatHora(hora) {
      return hora.replace(/(\d{2}):(\d{2})/, "$1:$2");
    }

    function renderAtendimentoTable(atendimentoList = atendimentos) {
      const atendimentoTableBody = document.getElementById("atendimentoTableBody");
      atendimentoTableBody.innerHTML = "";

      atendimentoList.forEach((atendimento, index) => {
        const row = atendimentoTableBody.insertRow();
        row.innerHTML = `
      <td>${atendimento.cliente}</td>
      <td>${formatData(atendimento.data)}</td>
      <td>${formatHora(atendimento.hora)}</td>
      <td>${atendimento.servico}</td> <!-- Exibe os serviços selecionados -->
      <td>R$ ${parseFloat(atendimento.valorCobrado).toFixed(2)}</td>
      <td>${atendimento.barbeiroResponsavel}</td>
      <td>${atendimento.formaPagamento || 'Não Informado'}</td> <!-- Forma de pagamento -->
      <td>
        <button onclick="editarAtendimento(${index})" class="btn btn-warning btn-sm">Editar</button>
        <button onclick="excluirAtendimento(${index})" class="btn btn-danger btn-sm">Excluir</button>
      </td>
    `;
      });
    }

    // Função para ordenar os atendimentos por data e hora
    function ordenarAtendimentos() {
      atendimentos.sort((a, b) => {
        // Comparar as datas
        const dataA = new Date(a.data);
        const dataB = new Date(b.data);
        if (dataA.getTime() !== dataB.getTime()) {
          return dataA.getTime() - dataB.getTime(); // Ordenar por data
        }

        // Se as datas forem iguais, comparar as horas
        const [horaA, minutoA] = a.hora.split(":").map(Number);
        const [horaB, minutoB] = b.hora.split(":").map(Number);
        const minutoATotal = horaA * 60 + minutoA;
        const minutoBTotal = horaB * 60 + minutoB;

        return minutoATotal - minutoBTotal; // Ordenar por hora
      });
    }

    // Função para adicionar atendimento à lista
    function adicionarAtendimento(novoAtendimento) {
      atendimentos.push(novoAtendimento);
      renderAtendimentoTable(); // Atualiza a tabela após adicionar
    }
    // Função para adicionar um novo atendimento
    document.getElementById("clientForm").onsubmit = function (event) {
      event.preventDefault();

      // Coletar os serviços selecionados
      const serviçosSelecionados = [];
      if (document.getElementById("servicoCabelo").checked) serviçosSelecionados.push("Cabelo");
      if (document.getElementById("servicoBarba").checked) serviçosSelecionados.push("Barba");
      if (document.getElementById("servicoBigode").checked) serviçosSelecionados.push("Bigode");
      if (document.getElementById("servicoSobrancelha").checked) serviçosSelecionados.push("Sobrancelha");

      const novoAtendimento = {
        cliente: document.getElementById("nome").value,
        data: document.getElementById("data").value,
        hora: document.getElementById("hora").value,
        servico: serviçosSelecionados.join(", "), // Aqui, armazenamos os serviços selecionados como uma string separada por vírgulas
        valorCobrado: document.getElementById("valorCobrado").value,
        barbeiroResponsavel: document.getElementById("barbeiroResponsavel").value,
        formaPagamento: document.getElementById("formaPagamento").value
      };

      adicionarAtendimento(novoAtendimento);

      // Fechar o modal de cadastro
      const modalCadastroElement = document.getElementById("modalCadastroAtendimento");
      const modalCadastro = bootstrap.Modal.getInstance(modalCadastroElement);
      modalCadastro.hide();  // Fechar o modal após o cadastro
    };

    // Função para editar um atendimento
    function editarAtendimento(index) {
      const atendimento = atendimentos[index];

      document.getElementById("editCliente").value = atendimento.cliente;
      document.getElementById("editData").value = atendimento.data;
      document.getElementById("editHora").value = atendimento.hora;

      // Marcar os serviços selecionados
      const servicos = atendimento.servico.split(", ");
      document.getElementById("editServicoCabelo").checked = servicos.includes("Cabelo");
      document.getElementById("editServicoBarba").checked = servicos.includes("Barba");
      document.getElementById("editServicoBigode").checked = servicos.includes("Bigode");
      document.getElementById("editServicoSobrancelha").checked = servicos.includes("Sobrancelha");

      document.getElementById("editBarbeiroResponsavel").value = atendimento.barbeiroResponsavel;
      document.getElementById("editFormaPagamento").value = atendimento.formaPagamento;
      document.getElementById("editValorCobrado").value = atendimento.valorCobrado; // Adicionando o valor cobrado

      const editForm = document.getElementById("editAtendimentoForm");
      editForm.onsubmit = function (event) {
        event.preventDefault();

        // Capturar os serviços selecionados
        const serviçosSelecionados = [];
        if (document.getElementById("editServicoCabelo").checked) serviçosSelecionados.push("Cabelo");
        if (document.getElementById("editServicoBarba").checked) serviçosSelecionados.push("Barba");
        if (document.getElementById("editServicoBigode").checked) serviçosSelecionados.push("Bigode");
        if (document.getElementById("editServicoSobrancelha").checked) serviçosSelecionados.push("Sobrancelha");

        // Atualizar o atendimento com os novos dados
        atendimento.cliente = document.getElementById("editCliente").value;
        atendimento.data = document.getElementById("editData").value;
        atendimento.hora = document.getElementById("editHora").value;
        atendimento.servico = serviçosSelecionados.join(", "); // Atualiza os serviços selecionados
        atendimento.barbeiroResponsavel = document.getElementById("editBarbeiroResponsavel").value;
        atendimento.formaPagamento = document.getElementById("editFormaPagamento").value;
        atendimento.valorCobrado = document.getElementById("editValorCobrado").value; // Atualiza o valor cobrado

        ordenarAtendimentos(); // Ordenar após editar
        renderAtendimentoTable(); // Atualizar a tabela com os novos dados

        // Fechar o modal de edição
        const modalEditarElement = document.getElementById("modalEditarAtendimento");
        const modalEditar = bootstrap.Modal.getInstance(modalEditarElement);
        modalEditar.hide();  // Fechar o modal após salvar as alterações
      };

      // Mostrar o modal de edição
      const modal = new bootstrap.Modal(document.getElementById("modalEditarAtendimento"));
      modal.show();
    }

    // Função para filtrar os atendimentos
    function filtrarAtendimentos() {
      const cliente = document.getElementById("filterCliente").value.toLowerCase();
      const data = document.getElementById("filterData").value;
      const hora = document.getElementById("filterHora").value;

      // Capturar os serviços selecionados
      const servicos = [];
      if (document.getElementById("filterServicoCabelo").checked) servicos.push("Cabelo");
      if (document.getElementById("filterServicoBarba").checked) servicos.push("Barba");
      if (document.getElementById("filterServicoBigode").checked) servicos.push("Bigode");
      if (document.getElementById("filterServicoSobrancelha").checked) servicos.push("Sobrancelha");

      const barbeiro = document.getElementById("filterBarbeiro").value.toLowerCase();
      const formaPagamento = document.getElementById("filterFormaPagamento").value.toLowerCase();

      const filteredAtendimentos = atendimentos.filter(atendimento => {
        // Filtragem por serviços: verificar se pelo menos um serviço está presente
        const atendeComServico = servicos.length === 0 || servicos.some(servico => atendimento.servico.toLowerCase().includes(servico.toLowerCase()));

        // Filtrar pela forma de pagamento selecionada
        const formaPagamentoValida = formaPagamento === "todos" || atendimento.formaPagamento.toLowerCase() === formaPagamento;

        return (
          (cliente ? atendimento.cliente.toLowerCase().includes(cliente) : true) &&
          (data ? atendimento.data === data : true) &&
          (hora ? atendimento.hora === hora : true) &&
          (atendeComServico) && // Verificar se o atendimento corresponde aos serviços selecionados
          (barbeiro ? atendimento.barbeiroResponsavel.toLowerCase().includes(barbeiro) : true) &&
          (formaPagamentoValida) // Verificar a forma de pagamento
        );
      });

      ordenarAtendimentos(); // Ordenar após filtrar
      renderAtendimentoTable(filteredAtendimentos); // Atualizar a tabela com os atendimentos filtrados
    }

    // Enviar o filtro de consulta
    document.getElementById("filterForm").onsubmit = function (event) {
      event.preventDefault();
      filtrarAtendimentos();

      // Fechar o modal de consulta - ajustando a criação da instância
      const modalConsultaElement = document.getElementById("modalConsultarAtendimento");
      const modalConsulta = bootstrap.Modal.getInstance(modalConsultaElement);
      modalConsulta.hide();  // Fechar o modal após aplicar o filtro
    };

    // Função para excluir um atendimento
    function excluirAtendimento(index) {
      atendimentos.splice(index, 1);
      ordenarAtendimentos(); // Ordenar após excluir
      renderAtendimentoTable();
    }

    // Inicializar a tabela com os dados
    renderAtendimentoTable();
  </script>

</body>

</html>